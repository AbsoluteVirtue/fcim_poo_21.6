# Что значит "объектно-ориентированный"?
Если поискать информацию о термине "объектно-ориентированный" в произвольных открытых источниках, в большинстве случаев приводится пример "трех китов ООП":
* инкапсуляция;
* наследованиеж;
* полиморфизм.

Эпиграфом может служить цитата известного дизайнера Грэди Буча, взятая из книги "Object-Oriented Analysis, Design and Implementation".

> "Язык считается объектным, если он напрямую поддерживает абстракцию данных и классы. Объектный язык является объектно-ориентированным, если он поддерживает наследование и полиморфизм."

Возможно, именно отсюда и пошла традиция привязывать три этих явления к ООП. Данный курс попытается доказать, что ни один из этих элементов не является критической частью ООП в отдельности. 

Инкапсуляция в Smalltalk (первом официально "объектно-ориентированном" языке) - это результат неправильных выводов, сделанных Аланом Кеем под влиянием дизайна Sketchpad (где инкапсуляции не было) и языка Simula (где она носила схематичный характер, о чем речь пойдет ниже).

Наследование никогда не было составной частью ООП, и даже в языке С++ от наследования какой-то общей структуры ушли к наследованию общего поведения через интерфейсы, а в итоге от него отказались в пользу статического полиморфизма. Тем не менее, наследование заслуживает более подробного рассмотрения, так как первоначально широко применялось в Smalltalk, в последствии оказавшись ненужным.

Полиморфизм - это свойство системы типов, которое само собой не подталкивает использовать объекты, скорее, являясь инструментом к достижению высокой степени обобщенности в коде. Полиморфизму будет посвящена отдельная глава. 

Начать стоит с изучения двух базовых элементов, о которых говорит Буч в своей книге: абстрактных данных и классов. И не только потому, что эти понятия сейчас тесно связаны с ООП. Алан Кей пользовался этими механизмами во время работы над языком Smalltalk, что требует их более внимательного рассмотрения.

В середине 1960х годов Кей работал в новой команде разработки, где ему порекомендовали ознакомиться с двумя на тот момент новыми примерами инновационного использования компьютерных технологий. Первой технологией была система компьютерного дизайна Sketchpad Айвана Сазерленда, которая стала одной из самых значимых работ в сфере компьютерных технологий. Второй был язык программирования Simula, использующий новую концепцию "классов как процессов" в качестве основного инструмента организации кода.

Зная о том, что в группе по разработке языка Algol высказывались идеи об использовании "абстрактных типов данных" (которые условно были названы PLEX Дагласом Россом, о ком подробней будет сказано далее), Кей попытался объединить идею "плексов" из Algol, классов из Simula и обощенных структур данных из Sketchpad.

Общая идея системы, над которой он работал, заключалась в создании сети компьютерных процессов, которая не позволяет процессам напрямую изменять состояния друг-друга. Вместо этого процессы должны были отправлять друг другу запросы в виде правильно сформированных сообщений. Так, для изменения какого-то значения один процесс посылал сообщение с новым значением другому процессу, который отвечал за данную область памяти. Процесс-получатель читал сообщение и принимал окончательное решение о том, нужно ли изменять значение в памяти или нет. Это позволяло программисту, работающему в такой системе, вместо простых инструкций с присваиванием значений отдельным переменным писать более абстрактные инструкции, описывающие желаемый окончательный результат. Процессы же сами должны были выбирать правильные инструкции для достижения результата.

## Объекты
Эта концепция появилась не на пустом месте. Кей был биологом по первому образованию и часто обращался к билогии за вдохновением. Для своей системы он выбрал поведение биологических клеток, которые защищены от внешнего мира мембраной, но могут обмениваться информацией с другими клетками с помощью специальных белков и соответствующих рецепторов. Кею эта модель нравилась тем, что систему, построенную по такому принципу, можно расширять до бесконечности, получая результат любой сложности (по аналогии с тем, как из одних и тех же клеток с помощью ДНК получаются разные организмы).

Кей предполагал, что и в компьютерных системах возможно создание программы любой сложности из обобщенных процессов, которые работают каждый по своим правилам, отвечают каждый за свою зону ответственности и взаимодействуют друг с другом согласно определенным протоколам. Прототипом такой системы стал Интернет, к разработке которого Кей тоже приложил свою руку. Если рассматривать процессы как отдельные компьютеры, объединенные в компьютерную сеть, в таком сценарии компьютеры могут взаимодействовать друг с другом только посредством отправки сообщений другим компьютерам, оставаясь независимыми вычислительными объектами, данные которых скрыты от остальных компьютеров в одной с ними сети. Таким образом компьютеры инкапсулируют данные в памяти и вычислительный процесс, а объединение таких процессов в общую сеть позволяет умножать их вычислительные возможности.

Это привело Алана Кея к простой модели, согласно которой могла быть написана любая компьютерная программа:
* базовой исполняющей сущностью является вычислительный процесс;
* процесс создает и поддерживает операции над сегментами данных в памяти;
* операции поддерживают параллельное исполнение;
* процессы должны отвечать на события (где событие - event - понимается как действие, распознаваемое в системе, происходящее асинхронно основному выполнению программы, которое может быть как-то программой обработано в ответ на соответствующий сигнал от системы);
* и т.д.

Кей называл свои процессы "объектами", откуда и пошел термин "объектно-ориентированное программирование". Поэтому данный курс будет использовать следующее определение объекта в дальнейшем.

Объект - это описание вычислительного процесса или семейства процессов, которое скрывает свои данные от внешней среды и может работать независимо от других объектов, взаимодействуя с ними с помощью сообщений, отправленных согласно какому-то протоколу.

Далее будут рассмотрены более подробно три главных примера, которые использовал в своей работе Алан Кей: абстрактные типы данных, классы и обобщенные структуры данных.

## Sketchpad – a man-machine graphical communication system
Чтобы в полной мере оценить важность Sketchpad для ООП, надо отметить, что Алан Кей называл эту работу "наверное, самой значимой дипломной работой в истории". Стоит только добавить, что Кей также называл Sketchpad первой "объектно-ориентированной" системой. Несколько свойств Sketchpad были напрямую переняты в Smalltalk, для того, чтобы он мог быть по-настоящему объектно-ориентированным языком.

### Master - instance
В Sketchpad дизайнер оперировал световым пером для того, чтобы создавать на экране компьютера чертежи. Чертежи организовывались в иерархию, в которой была главный чертеж (master drawing), изменения которого отражались на всеъ копиях главного чертежа. Копии или "экземпляры" (instances) создавались на основе главного чертежа, повторяя все его свойства, причем изменения одной копии никак не отражались на остальных элементах чертежа. Экземпляры можно было использовать для создания новых "рекурсивных" иерархий любой степени вложенности. Этот принцип позже лег в основу иерархий наследования, которые создавались в Smalltalk.

### Constraints
Между фигурами на чертежах устанавливались определенные отношения. Например, можно было обозначить две линии отдельной фигуры параллельными, чтобы независимо от последующих манипуляций (повороты, уменьшение, увеличение экземпляров) это свойство гарантированно сохранялось. За сохранение таких отношений - атомарных ограничений - отвечал отдельный процесс.

За управление объектами, своевременное и правильное применение процедур к ним и т.п. отвечал процесс "разрешения ограничений", который решал динамическую задачу, когда задача по манипуляции фигурой ставилась действиями пользователя. То есть, пользователю нет необходимости явно задавать все шаги, нужные для правильного поворота экземпляра, достаточно просто обозначить свое намерение посредством интерфейса программы, и "решатель" запускал все нужные процедуры в правильной последовательности. Такая "непроцедурная" система описания программ стала одним из самых ранних примеров декларативного программирования.

### Абстрактный тип данных
В системе Sketchpad была определена иерархия - "вселенная" - возможных объектов: скаляров, точек в системе координат, строк текста и т.д. Возможные ограничения тоже формировали одну ветку данной иерархии. Все элементы данной иерархии описывались структурами данных в памяти программы. Все они имели общие свойства, но также каждый тип объекта имел уникальные свойства, которые отличали его от других типов объектов. Так, все структуры содержали поле "тип", для динамического определения типа текущего экземпляра; поле "имя" позволяло называть экземпляры; поле "вид" обозначало характер отображения; поле "дисплей" хранило процедуру ("подпрограмму") для отображения экземпляра; поле "движение" определяло процедуру для трансформаций на экране и т.д. Таким образом, в одной записи в памяти инкапсулировались и данные, и возможные операции над этими данными. 

Алан Кей понимал, что такой подход является хорошей моделью для его системы независимых объектов, которые можно комбинировать в любой конфигурации. На его вопрос Сазерленду: как тому удалось сделать первую интерактивную графическую программу, первый декларативный язык программирования и первую объектно-ориентированную систему - Сазерленд отвечал, что он просто тогда не знал, что это сложно.

Несмотря на это, у Sketchpad было одно свойство, которое Алан Кей не стал переносить в свою систему. Как он позже объяснял:

> "Еще одной важной системой, созданной в этот период, была Thinglab Алана Борнинга - первая серьезная попытка пойти дальше, чем Sketchpad. Алан придумал красивый подход к решению задач с ограничениями, в котором разрешающий процесс не обязан был быть всезнающим (т.е. не требовал знать состояние всей системы в каждый момент времени)."

Это важное замечание, которое дает представление о том, что Алан Кей считал критичным для дизайна объектно-ориентированных систем. Сокрытие данных было одним таким критичным свойством. Оно позволяло полностью отказаться от операций присваивания в языке и, как следствие, мотивировать программиста мыслить о программах в новой парадигме.
